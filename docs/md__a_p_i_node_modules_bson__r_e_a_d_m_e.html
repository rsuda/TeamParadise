<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Team Paradise: BSON parser</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Team Paradise
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">BSON parser </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>BSON is short for Bin­ary JSON and is the bin­ary-en­coded seri­al­iz­a­tion of JSON-like doc­u­ments. You can learn more about it in <a href="http://bsonspec.org">the specification</a>.</p>
<p>This browser version of the BSON parser is compiled using <a href="https://webpack.js.org/">webpack</a> and the current version is pre-compiled in the <code>browser_build</code> directory.</p>
<p>This is the default BSON parser, however, there is a C++ Node.js addon version as well that does not support the browser. It can be found at <a href="https://github.com/mongodb-js/bson-ext">mongod-js/bson-ext</a>.</p>
<h1><a class="anchor" id="autotoc_md286"></a>
Usage</h1>
<p>To build a new version perform the following operations:</p>
<div class="fragment"><div class="line">npm install</div>
<div class="line">npm run build</div>
</div><!-- fragment --><p>A simple example of how to use BSON in the browser:</p>
<div class="fragment"><div class="line">&lt;script src=&quot;./browser_build/bson.js&quot;&gt;&lt;/script&gt;</div>
<div class="line"> </div>
<div class="line">&lt;script&gt;</div>
<div class="line">  function start() {</div>
<div class="line">    // Get the Long type</div>
<div class="line">    var Long = BSON.Long;</div>
<div class="line">    // Create a bson parser instance</div>
<div class="line">    var bson = new BSON();</div>
<div class="line"> </div>
<div class="line">    // Serialize document</div>
<div class="line">    var doc = { long: Long.fromNumber(100) }</div>
<div class="line"> </div>
<div class="line">    // Serialize a document</div>
<div class="line">    var data = bson.serialize(doc)</div>
<div class="line">    // De serialize it again</div>
<div class="line">    var doc_2 = bson.deserialize(data)</div>
<div class="line">  }</div>
<div class="line">&lt;/script&gt;</div>
</div><!-- fragment --><p>A simple example of how to use BSON in <code>Node.js</code>:</p>
<div class="fragment"><div class="line">// Get BSON parser class</div>
<div class="line">var BSON = require(&#39;bson&#39;)</div>
<div class="line">// Get the Long type</div>
<div class="line">var Long = BSON.Long;</div>
<div class="line">// Create a bson parser instance</div>
<div class="line">var bson = new BSON();</div>
<div class="line"> </div>
<div class="line">// Serialize document</div>
<div class="line">var doc = { long: Long.fromNumber(100) }</div>
<div class="line"> </div>
<div class="line">// Serialize a document</div>
<div class="line">var data = bson.serialize(doc)</div>
<div class="line">console.log(&#39;data:&#39;, data)</div>
<div class="line"> </div>
<div class="line">// Deserialize the resulting Buffer</div>
<div class="line">var doc_2 = bson.deserialize(data)</div>
<div class="line">console.log(&#39;doc_2:&#39;, doc_2)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md287"></a>
Installation</h1>
<p><code>npm install bson</code></p>
<h1><a class="anchor" id="autotoc_md288"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md289"></a>
BSON types</h2>
<p>For all BSON types documentation, please refer to the following sources:</p><ul>
<li><a href="https://docs.mongodb.com/manual/reference/bson-types/">MongoDB BSON Type Reference</a></li>
<li><a href="https://bsonspec.org/">BSON Spec</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md290"></a>
BSON serialization and deserialiation</h2>
<p>**<code>new BSON()</code>** - Creates a new BSON serializer/deserializer you can use to serialize and deserialize BSON.</p>
<h3><a class="anchor" id="autotoc_md291"></a>
BSON.serialize</h3>
<p>The BSON <code>serialize</code> method takes a JavaScript object and an optional options object and returns a Node.js Buffer.</p>
<ul>
<li><code>BSON.serialize(object, options)</code><ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>object the JavaScript object to serialize.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.checkKeys=false] the serializer will check if keys are valid.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.serializeFunctions=false] serialize the JavaScript functions.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.ignoreUndefined=true]</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>{Buffer} returns a Buffer instance.</dd></dl>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md292"></a>
BSON.serializeWithBufferAndIndex</h3>
<p>The BSON <code>serializeWithBufferAndIndex</code> method takes an object, a target buffer instance and an optional options object and returns the end serialization index in the final buffer.</p>
<ul>
<li><code>BSON.serializeWithBufferAndIndex(object, buffer, options)</code><ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>object the JavaScript object to serialize.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Buffer}</td><td>buffer the Buffer you pre-allocated to store the serialized BSON object.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.checkKeys=false] the serializer will check if keys are valid.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.serializeFunctions=false] serialize the JavaScript functions.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.ignoreUndefined=true] ignore undefined fields.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Number}</td><td>[options.index=0] the index in the buffer where we wish to start serializing into.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>{Number} returns the index pointing to the last written byte in the buffer.</dd></dl>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md293"></a>
BSON.calculateObjectSize</h3>
<p>The BSON <code>calculateObjectSize</code> method takes a JavaScript object and an optional options object and returns the size of the BSON object.</p>
<ul>
<li><code>BSON.calculateObjectSize(object, options)</code><ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>object the JavaScript object to serialize.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.serializeFunctions=false] serialize the JavaScript functions.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Boolean}</td><td>[options.ignoreUndefined=true]</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>{Buffer} returns a Buffer instance.</dd></dl>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md294"></a>
BSON.deserialize</h3>
<p>The BSON <code>deserialize</code> method takes a Node.js Buffer and an optional options object and returns a deserialized JavaScript object.</p>
<ul>
<li><code>BSON.deserialize(buffer, options)</code><ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.evalFunctions=false] evaluate functions in the BSON document scoped to the object deserialized.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.cacheFunctions=false] cache evaluated functions for reuse.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.cacheFunctionsCrc32=false] use a crc32 code for caching, otherwise use the string of the function.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.promoteLongs=true] when deserializing a Long will fit it into a Number if it's smaller than 53 bits</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.promoteBuffers=false] when deserializing a Binary will return it as a Node.js Buffer instance.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.promoteValues=false] when deserializing will promote BSON values to their Node.js closest equivalent types.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.fieldsAsRaw=null] allow to specify if there what fields we wish to return as unserialized raw buffer.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.bsonRegExp=false] return BSON regular expressions as BSONRegExp instances.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>{Object} returns the deserialized Javascript Object.</dd></dl>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md295"></a>
BSON.deserializeStream</h3>
<p>The BSON <code>deserializeStream</code> method takes a Node.js Buffer, <code>startIndex</code> and allow more control over deserialization of a Buffer containing concatenated BSON documents.</p>
<ul>
<li><code>BSON.deserializeStream(buffer, startIndex, numberOfDocuments, documents, docStartIndex, options)</code><ul>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Buffer}</td><td>buffer the buffer containing the serialized set of BSON documents.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Number}</td><td>startIndex the start index in the data Buffer where the deserialization is to start.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Number}</td><td>numberOfDocuments number of documents to deserialize.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Array}</td><td>documents an array where to store the deserialized documents.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Number}</td><td>docStartIndex the index in the documents array from where to start inserting documents.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.evalFunctions=false] evaluate functions in the BSON document scoped to the object deserialized.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.cacheFunctions=false] cache evaluated functions for reuse.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.cacheFunctionsCrc32=false] use a crc32 code for caching, otherwise use the string of the function.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.promoteLongs=true] when deserializing a Long will fit it into a Number if it's smaller than 53 bits</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.promoteBuffers=false] when deserializing a Binary will return it as a Node.js Buffer instance.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.promoteValues=false] when deserializing will promote BSON values to their Node.js closest equivalent types.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.fieldsAsRaw=null] allow to specify if there what fields we wish to return as unserialized raw buffer.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">{Object}</td><td>[options.bsonRegExp=false] return BSON regular expressions as BSONRegExp instances.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><dl class="section return"><dt>Returns</dt><dd>{Number} returns the next index in the buffer after deserialization <b>x</b> numbers of documents.</dd></dl>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md296"></a>
FAQ</h1>
<h3><a class="anchor" id="autotoc_md297"></a>
Why does &lt;tt&gt;undefined&lt;/tt&gt; get converted to &lt;tt&gt;null&lt;/tt&gt;?</h3>
<p>The <code>undefined</code> BSON type has been <a href="http://bsonspec.org/spec.html">deprecated for many years</a>, so this library has dropped support for it. Use the <code>ignoreUndefined</code> option (for example, from the <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/MongoClient.html#connect">driver</a> ) to instead remove <code>undefined</code> keys.</p>
<h3><a class="anchor" id="autotoc_md298"></a>
How do I add custom serialization logic?</h3>
<p>This library looks for <code>toBSON()</code> functions on every path, and calls the <code>toBSON()</code> function to get the value to serialize.</p>
<div class="fragment"><div class="line">var bson = new BSON();</div>
<div class="line"> </div>
<div class="line">class CustomSerialize {</div>
<div class="line">  toBSON() {</div>
<div class="line">    return 42;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const obj = { answer: new CustomSerialize() };</div>
<div class="line">// &quot;{ answer: 42 }&quot;</div>
<div class="line">console.log(bson.deserialize(bson.serialize(obj)));</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
